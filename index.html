<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Miden - Miden VM</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html" class="active">Miden</a></li><li class="chapter-item expanded "><a href="introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="user_documentation.html"><strong aria-hidden="true">2.</strong> User Documentation</a></li><li class="chapter-item expanded "><a href="design.html"><strong aria-hidden="true">3.</strong> Design</a></li><li class="chapter-item expanded "><a href="background_material.html"><strong aria-hidden="true">4.</strong> Background Material</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Miden VM</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="polygon-miden"><a class="header" href="#polygon-miden">Polygon Miden</a></h1>
<p><a href="https://github.com/maticnetwork/miden/blob/main/LICENSE"><img src="https://img.shields.io/badge/license-MIT-blue.svg"></a>
<img src="https://github.com/maticnetwork/miden/workflows/CI/badge.svg?branch=main">
<a href="https://deps.rs/repo/github/maticnetwork/miden"><img src="https://deps.rs/repo/github/maticnetwork/miden/status.svg"></a>
<a href="https://crates.io/crates/miden"><img src="https://img.shields.io/crates/v/miden"></a></p>
<p>A STARK-based virtual machine.</p>
<p><strong>WARNING:</strong> This project is in an alpha stage. It has not been audited and may contain bugs and security flaws. This implementation is NOT ready for production use.</p>
<h2 id="overview"><a class="header" href="#overview">Overview</a></h2>
<p>Miden is a zero-knowledge virtual machine written in Rust. For any program executed on Miden VM, a STARK-based proof of execution is automatically generated. This proof can then be used by anyone to verify that a program was executed correctly without the need for re-executing the program or even knowing what the program was.</p>
<ul>
<li>If you'd like to learn more about how Miden VM works, check out the <a href="miden">miden</a> crate.</li>
<li>If you'd like to see Miden VM in action, check out the <a href="examples">examples</a> crate.</li>
<li>If you'd like to learn more about STARKs, check out the <a href="#references">references</a> section.</li>
</ul>
<h3 id="status-and-features"><a class="header" href="#status-and-features">Status and features</a></h3>
<p>Currently, this project contains a direct port of the original <a href="https://github.com/guildofweavers/distaff">Distaff VM</a> to <a href="https://github.com/novifinancial/winterfell">Winterfell</a> backend. This means that, as compared to the original Distaff VM, the proving system has been upgraded to a much more up-to-date and performant STARK prover - but, the functionality of the VM remained the same. This functionality includes:</p>
<ul>
<li><strong>Field arithmetic.</strong> Miden VM can execute one field operation per cycle. This includes addition, multiplication, inversion, and boolean operations (on binary values).</li>
<li><strong>Conditional statements.</strong> Miden VM programs can include basic <em>if-then-else</em> statements, however, these statements can be nested at most 16 levels deep.</li>
<li><strong>Loops.</strong> Miden VM programs can include counter-controlled (<em>for</em>) and condition-controlled (<em>while</em>) loops. However, loops can be nested at most 8 levels deep.</li>
<li><strong>Inequality comparisons.</strong> Miden VM supports <em>less-than</em> and <em>greater-than</em> comparison of field elements (via binary decomposition). However, each comparison requires dozens of VM cycles.</li>
<li><strong>Hashing.</strong> Miden VM natively supports Rescue hash function. A 2-to-1 Rescue hash can be computed in as few as 10 VM cycles.</li>
</ul>
<h4 id="planned-features"><a class="header" href="#planned-features">Planned features</a></h4>
<p>In the coming months we plan to make significant changes to the VM to expand its feature set. Among other things, these will include:</p>
<ul>
<li><strong>Flow control.</strong> Restrictions on nestings of loops and conditional statements will be removed.</li>
<li><strong>Memory.</strong> Support for read-write random-access memory will be added to the VM.</li>
<li><strong>Storage.</strong> Support for read-write persistent storage will be added to the VM.</li>
<li><strong>Function calls.</strong> Miden programs will support hash-addressable function calls.</li>
<li><strong>u32 operations.</strong> The VM will be able to execute a single u32 operation per cycle.</li>
</ul>
<p>Our ultimate goal is to make Miden VM an easy compilation target for high level languages such as Solidity, Move, and others.</p>
<p>The new version of the VM is being developed in the <a href="https://github.com/maticnetwork/miden/tree/next">next</a> branch.</p>
<h3 id="project-structure"><a class="header" href="#project-structure">Project structure</a></h3>
<p>The project is organized into several crates like so:</p>
<table><thead><tr><th>Crate</th><th>Description</th></tr></thead><tbody>
<tr><td><a href="core">core</a></td><td>Contains components defining Miden VM instruction set, program structure, and a set of utility functions used by other crates.</td></tr>
<tr><td><a href="assembly">assembly</a></td><td>Contains Miden assembler and definition of the Miden Assembly language. The assembler is used to compile Miden assembly source code into Miden VM programs.</td></tr>
<tr><td><a href="processor">processor</a></td><td>Contains Miden VM processor. The processor is used to execute Miden programs and to generate program execution traces. These traces are then used by the VM to generate proofs of correct program execution.</td></tr>
<tr><td><a href="air">air</a></td><td>Contains <em>algebraic intermediate representation</em> (AIR) of Miden VM processor logic. This AIR is used by the VM during proof generation and verification processes.</td></tr>
<tr><td><a href="miden">miden</a></td><td>Contains the actual Miden VM which can be used to execute programs and verify proofs of their execution.</td></tr>
<tr><td><a href="verifier">verifier</a></td><td>Contains a light-weight verifier which can be used to verify proofs of program execution generated by Miden VM.</td></tr>
<tr><td><a href="examples">examples</a></td><td>Contains several toy and real-world examples of Miden VM programs and demonstrates how these programs can be executed on Miden VM.</td></tr>
</tbody></table>
<h2 id="performance"><a class="header" href="#performance">Performance</a></h2>
<p>Current version of Miden VM operates at around 10 KHz when run on a single CPU core. When run on a 16-core CPU, Miden VM can operate at over 80 KHz. In the future we hope to significantly improve this performance.</p>
<p>In the benchmarks below, the VM executes a <a href="miden/README.html#Fibonacci-calculator">Fibonacci calculator</a> program on AMD Ryzen 9 5950X CPU (single thread):</p>
<table style="text-align:center">
    <thead>
        <tr>
            <th rowspan=2 style="text-align:left">Operations</th>
            <th colspan=3 style="text-align:center">96-bit security</th>
            <th colspan=3 style="text-align:center">128-bit security</th>
        </tr>
        <tr>
            <th style="text-align:center">Execution time</th>
            <th>Execution RAM</th>
            <th>Proof size</th>
            <th>Execution time</th>
            <th>Execution RAM</th>
            <th>Proof size</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align:left">2<sup>8</sup></td>
            <td>27 ms</td>
            <td>9 MB</td>
            <td>28 KB</td>
            <td>200 ms</td>
            <td>9 MB</td>
            <td>45 KB</td>
        </tr>
        <tr>
            <td style="text-align:left">2<sup>10</sup></td>
            <td>81 ms</td>
            <td>11 MB</td>
            <td>34 KB</td>
            <td>170 ms</td>
            <td>13 MB</td>
            <td>59 KB</td>
        </tr>
        <tr>
            <td style="text-align:left">2<sup>12</sup></td>
            <td>314 ms</td>
            <td>22 MB</td>
            <td>42 KB</td>
            <td>680 ms</td>
            <td>58 MB</td>
            <td>70 KB</td>
        </tr>
        <tr>
            <td style="text-align:left">2<sup>14</sup></td>
            <td>1.3 sec</td>
            <td>81 MB</td>
            <td>51 KB</td>
            <td>2.2 sec</td>
            <td>204 MB</td>
            <td>82 KB</td>
        </tr>
        <tr>
            <td style="text-align:left">2<sup>16</sup></td>
            <td>5.4 sec</td>
            <td>313 MB</td>
            <td>59 KB</td>
            <td>9.1 sec</td>
            <td>800 MB</td>
            <td>100 KB</td>
        </tr>
        <tr>
            <td style="text-align:left">2<sup>18</sup></td>
            <td>22.3 sec</td>
            <td>1.2 GB</td>
            <td>69 KB</td>
            <td>39 sec</td>
            <td>3.2 GB</td>
            <td>115 KB</td>
        </tr>
        <tr>
            <td style="text-align:left">2<sup>20</sup></td>
            <td>1.5 min</td>
            <td>4.9 GB</td>
            <td>82 KB</td>
            <td>2.7 min</td>
            <td>12.3 GB</td>
            <td>129 KB</td>
        </tr>
    </tbody>
</table>
<p>A few notes about these results:</p>
<ol>
<li>Execution time is dominated by the proof generation time. In fact, the time needed to run the program is only about 3% of the time needed to generate the proof.</li>
<li>Proof verification time is really fast. In most cases it is under 1 ms, but sometimes gets as high as 2 ms.</li>
<li>Proof generation process is dynamically adjustable. In general, there is a trade-off between execution time, proof size, and security level (i.e. for a given security level, we can reduce proof size by increasing execution time, up to a point).</li>
</ol>
<p>However, we don't have to limit ourselves to a single thread: STARK proof generation is massively parallelizable. The benchmarks below show program execution time for running the Fibonacci calculator for 2<sup>16</sup> operations (for 96-bit security level) using varying number of threads.</p>
<table><thead><tr><th>Threads</th><th style="text-align: center">Execution time</th><th style="text-align: center">Improvement</th></tr></thead><tbody>
<tr><td>1</td><td style="text-align: center">5.4 sec</td><td style="text-align: center">1x</td></tr>
<tr><td>2</td><td style="text-align: center">2.9 sec</td><td style="text-align: center">1.9x</td></tr>
<tr><td>4</td><td style="text-align: center">1.6 sec</td><td style="text-align: center">3.4x</td></tr>
<tr><td>8</td><td style="text-align: center">0.95 sec</td><td style="text-align: center">5.7x</td></tr>
<tr><td>16</td><td style="text-align: center">0.7 sec</td><td style="text-align: center">7.7x</td></tr>
<tr><td>32</td><td style="text-align: center">0.6 sec</td><td style="text-align: center">9x</td></tr>
</tbody></table>
<p>A few notes about these results:</p>
<ol>
<li>Ryzen 9 5950X has 16 cores. So, executing the program in 32 threads seems to lead a slightly better CPU core utilization as compared to running it in 16 threads.</li>
<li>The Fibonacci calculator program is sequential - so, we can parallelize only the proof generation part. This means that the share of time taken up by running the program itself grows proportionally. For example, when we execute the program using 32 threads, the time it takes to run the program is roughly 25% of the overall execution time (vs 3% for a single thread).</li>
</ol>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<p>Proofs of execution generated by Miden VM are based on STARKs. A STARK is a novel proof-of-computation scheme that allows you to create an efficiently verifiable proof that a computation was executed correctly. The scheme was developed by Eli Ben-Sasson, Michael Riabzev et al. at Technion - Israel Institute of Technology. STARKs do not require an initial trusted setup, and rely on very few cryptographic assumptions.</p>
<p>Here are some resources to learn more about STARKs:</p>
<ul>
<li>STARKs whitepaper: <a href="https://eprint.iacr.org/2018/046">Scalable, transparent, and post-quantum secure computational integrity</a></li>
<li>STARKs vs. SNARKs: <a href="https://nakamoto.com/cambrian-explosion-of-crypto-proofs/">A Cambrian Explosion of Crypto Proofs</a></li>
</ul>
<p>Vitalik Buterin's blog series on zk-STARKs:</p>
<ul>
<li><a href="https://vitalik.ca/general/2017/11/09/starks_part_1.html">STARKs, part 1: Proofs with Polynomials</a></li>
<li><a href="https://vitalik.ca/general/2017/11/22/starks_part_2.html">STARKs, part 2: Thank Goodness it's FRI-day</a></li>
<li><a href="https://vitalik.ca/general/2018/07/21/starks_part_3.html">STARKs, part 3: Into the Weeds</a></li>
</ul>
<p>Alan Szepieniec's STARK tutorial:</p>
<ul>
<li><a href="https://aszepieniec.github.io/stark-anatomy/">Anatomy of a STARK</a></li>
</ul>
<p>StarkWare's STARK Math blog series:</p>
<ul>
<li><a href="https://medium.com/starkware/stark-math-the-journey-begins-51bd2b063c71">STARK Math: The Journey Begins</a></li>
<li><a href="https://medium.com/starkware/arithmetization-i-15c046390862">Arithmetization I</a></li>
<li><a href="https://medium.com/starkware/arithmetization-ii-403c3b3f4355">Arithmetization II</a></li>
<li><a href="https://medium.com/starkware/low-degree-testing-f7614f5172db">Low Degree Testing</a></li>
<li><a href="https://medium.com/starkware/a-framework-for-efficient-starks-19608ba06fbe">A Framework for Efficient STARKs</a></li>
</ul>
<h2 id="license"><a class="header" href="#license">License</a></h2>
<p>This project is <a href="./LICENSE">MIT licensed</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="next" href="introduction.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="next" href="introduction.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://localhost:3000/__livereload");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
